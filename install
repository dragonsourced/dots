#!/bin/sh
#
# Clone various repositories and move them to the proper place.

sudo echo Authorization accepted.

case "$1" in
    -f) FORCE=1 ;;
esac

tilde() {
    echo "$*" | sed "s|$HOME|~|"
}

dl() {
    src="$1"
    dest="$2"
    destdir="$(dirname "$2")"
    name="$(basename "$src")"

    mkdir -p "$destdir"
    mkdir -p src

    [ "$FORCE" ] && { [ -L "$dest" ] || [ -d "$dest" ]; } && rm -rf "$dest"

    if [ -L "$dest" ] || [ -d "$dest" ]; then
        echo "$(tilde "$dest") is already installed"
    else
        mkdir -p "$destdir"
        git clone "$src" "$dest"
        script="$PWD/scripts/$name"
        if [ -f "$script" ]; then
            (
                cd "$dest" || exit
                sh "$script"
            )
        fi
    fi
}

install() {
	mkdir -pv "$(dirname "$2")"
	if [ -d "$1" ]; then
		ln -s "$1" "$2"
	else
		ln "$1" "$2"
	fi
}

# Install the profile first, as it has all the PATH modifications.
cp profile ~/.profile

# shellcheck disable=1090
. ~/.profile

# Initialize these directories for reasons.

mkdir -p ~/src/repos
mkdir -p ~/bin

dl https://github.com/dragonsourced/scripts ~/src/scripts
dl https://github.com/dragonsourced/nvim    ~/.config/nvim
dl https://github.com/dragonsourced/rofi    ~/.config/rofi
dl https://github.com/dragonsourced/wm      ~/src/ui/wm
dl https://github.com/dylanaraps/sowm       ~/src/ui/sowm
dl https://github.com/dragonsourced/st      ~/src/ui/st
dl https://github.com/dragonsourced/slock   ~/src/ui/slock
dl https://github.com/dragonsourced/utils   ~/src/utils
dl https://github.com/dragonsourced/misc    ~/src/misc

dl https://github.com/dunst-project/dunst ~/pkg/dunst
dl git://git.codemadness.org/sfeed        ~/pkg/sfeed

install userChrome.css ~/src/ui/userChrome.css

install gtk/light ~/.config/oomox/colors/light
install gtk/dark  ~/.config/oomox/colors/dark
install gtk/oomox-light ~/.themes/oomox-light
install gtk/oomox-dark  ~/.themes/oomox-dark

install spicetify/theme  ~/.config/spicetify/Themes

mkdir -p ~/src/ui
install themes ~/src/ui

crontab ./crontab
