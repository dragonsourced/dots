#!/bin/sh
#
# Clone various repositories and move them to the proper place.

# install(from, to, script)

install() {
    src="$1"
    dest="$2"
    destdir="$(dirname "$2")"
    name="$(filename "$src")"

    mkdir -p "$destdir"
    mkdir -p src

    if [ -d "$dest" ] || [ -f "$dest" ]; then
        echo "$src is already installed"
    else
	mkdir -p "$destdir"
	git clone "$src" "$dest"
	script="scripts/$name"
	if [ -f "$script" ]; then
		(
			cd "$dest" || exit
			sh "$name"
		)
	fi
    fi
}

# Install the profile first, as it has all the PATH modifications.
install profile  ~/.profile

# shellcheck disable=1090
. ~/.profile

# Install various files
make install -C sub/sowm

make install -C sub/utils
( cd sub/utils/sfeed_fmt || exit; go install )

# Install vim-plug for Neovim
curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

install https://github.com/dragonsourced/scripts ~/src/scripts
install https://github.com/dragonsourced/nvim    ~/.config/nvim
install https://github.com/dragonsourced/sowm    ~/src/ui/sowm
install https://github.com/dragonsourced/st      ~/src/ui/st
install https://github.com/dragonsourced/utils   ~/src/utils
